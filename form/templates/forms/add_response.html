{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Add Response</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/add_response.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1>Respond to Form "{{ form_instance.title }}"</h1>
        {% if form_instance.image %}
            <img src="{{ form_instance.image.url }}" alt="Form Image" style="width: 80%;">
        {% endif %}
        <p>{{ form_instance.description }} {{ form_instance.termsandconditions }}</p>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {% if user.role != "Player" %}
                <label>Related Player</label>
                <select id="related_player" name="related_player">
                    <option value="None">------</option>
                    {% for player in players %}
                        <option value="{{ player.id }}">{{ player.name }}</option>
                    {% endfor %}
                </select>
            {% endif %}

            {% for question in form_instance.questions.all %}
            <div>
                {% if question.question_image %}
                    <img src="{{ question.question_image.url }}" alt="Question Image" style="width: 80%;">
                {% endif %}
                <label>{{ question.question_text }}</label><br>
                {% if question.question_type == 'short_answer' %}
                    <input type="text" name="question_{{ question.id }}">
                {% elif question.question_type == 'paragraph' %}
                    <textarea name="question_{{ question.id }}"></textarea>
                {% elif question.question_type == 'multiple_choice' %}
                    {% for choice in question.options.all %}
                        <input type="radio" name="question_{{ question.id }}" value="{{ choice.choice_text }}"> {{ choice.choice_text }}<br>
                    {% endfor %}
                {% elif question.question_type == 'checkbox' %}
                    {% for choice in question.options.all %}
                        <input type="checkbox" name="question_{{ question.id }}" value="{{ choice.choice_text }}"> {{ choice.choice_text }}<br>
                    {% endfor %}
                {% elif question.question_type == 'dropdown' %}
                    <select name="question_{{ question.id }}">
                        {% for choice in question.options.all %}
                            <option value="{{ choice.choice_text }}">{{ choice.choice_text }}</option>
                        {% endfor %}
                    </select>
                {% elif question.question_type == 'multiple_choice_grid' %}
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Player Name</th>
                                {% for choice in question.options.all %}
                                    <th>{{ choice.choice_text }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for player in question.player_list.all %}
                            <tr>
                                <td>{{ player.name }}</td>
                                {% for choice in question.options.all %}
                                    <td><input type="radio" name="question_{{ player.id }}" value="{{ choice.choice_text }}" required></td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% if question.input_add_player and user.role != "Player" %}
                        <a href="{% url 'form:add_player' question.id form_instance.id %}" class="btn btn-secondary">Add Player</a>
                    {% endif %}
                {% elif question.question_type == 'file_upload' %}
                    <input type="file" name="question_{{ question.id }}">
                {% elif question.question_type == 'date' %}
                    <input type="date" name="question_{{ question.id }}" required>
                {% elif question.question_type == 'time' %}
                    <input type="time" name="question_{{ question.id }}" required>
                {% endif %}
            </div>
            {% endfor %}
            <button type="submit" class="btn btn-primary mt-3">Submit Response</button>
        </form>

        <div class="inner-container mt-5">
            {% if existing_responses %}
            <h2>Submitted Responses</h2>
            <div class="line"></div>
            {% for response in existing_responses %}
            <div class="response-container">
                <h3>Response {{ forloop.counter }}</h3>
                <ul>
                    {% for answer in response.answers.all %}
                    <li>
                        <strong>{{ answer.question.question_text }}:</strong>
                        {% if answer.question.question_type == 'file_upload' %}
                            {% if answer.file_upload %}
                                <a href="{{ answer.file_upload.url }}" download>Download File</a>
                            {% else %}
                                No file uploaded
                            {% endif %}
                        {% else %}
                            {{ answer.answer_text }}
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% if user.role != "Player" %}
                    <a class="btn btn-secondary" href="{% url 'form:edit_response' response.id %}">Edit Response</a>
                {% endif %}
            </div>
            {% endfor %}
            {% else %}
            <p>No responses submitted yet.</p>
            {% endif %}

            {% if user.role != "Player" %}
                <a class="btn btn-secondary mt-3" href="{% url 'form:list_forms' %}">Back to Form List</a>
            {% endif %}
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-zJ3+PoYG2hIe7w6FIp40/xzWq58jz3IMtkJqjRn5YqUo2+0D98IjOBhp0+P8DrMo"
        crossorigin="anonymous"></script>
</body>

</html>
