{% load static %}
{% load custom_filters %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Response</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/add_response.css' %}">
</head>
<body>
    <div style="position: fixed; top: 80px; right: 10px; z-index: 1000; background-color: #f1f1f1; padding: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
        {% if user.is_authenticated %}
            <span><strong>{{ user.username }}</strong> - {{ user.get_role_display }}</span>
            <form method="POST" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" style="background-color: #dd1710; color: white; border: none; padding: 5px 10px; margin-left: 10px; cursor: pointer;">Logout</button>
            </form>
        {% else %}
            <span>Not logged in</span>
        {% endif %}
    </div>
    <center><div class="container">
    <h1>Edit Response for "{{ form_instance.title }}"</h1>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {% for question in form_instance.questions.all %}
            <div>
                <label>{{ question.question_text }}</label><br>
                {% with question_id=question.id %}
                    {% if question.question_type == 'short_answer' %}
                        <input type="text" name="question_{{ question_id }}" value="{{answers|dict_get:question_id }}">
                    {% elif question.question_type == 'paragraph' %}
                        <textarea name="question_{{ question_id }}">{{answers|dict_get:question_id }}</textarea>
                    {% elif question.question_type == 'multiple_choice' %}
                        {% for choice in question.options.all %}
                            <input type="radio" name="question_{{ question_id }}" value="{{ choice.choice_text }}" {% if answers|dict_get:question_id == choice.choice_text %}checked{% endif %}> {{ choice.choice_text }}<br>
                        {% endfor %}
                    {% elif question.question_type == 'multiple_choice_grid' %}
                        <table class="table table-striped ">
                            <thead>
                            <tr>
                                <th>Player</th>
                                {% for choice in question.options.all %}
                                    <th>{{choice.choice_text}}</th>
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                                {% for player in question.player_list.all %}
                                <tr>
                                    <td>{{ player.name}}</td>
                                    {% for choice in question.options.all %}
                                        <td><input type="radio" name="question_{{ player.id }}" value="{{ choice.choice_text }}" {% if answers|dict_get:question_id  in choice.choice_text %}checked{% endif %}> </td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% elif question.question_type == 'checkbox' %}
                        {% for choice in question.options.all %}
                            <input type="checkbox" name="question_{{ question_id }}" value="{{ choice.choice_text }}" {% if choice.choice_text in answers|dict_get:question_id %}checked{% endif %}> {{ choice.choice_text }}<br>
                        {% endfor %}
                    {% elif question.question_type == 'dropdown' %}
                        <select name="question_{{ question_id }}">
                            {% for choice in question.options.all %}
                                <option value="{{ choice.choice_text }}" {% if answers|dict_get:question_id == choice.choice_text %}selected{% endif %}>{{ choice.choice_text }}</option>
                            {% endfor %}
                        </select>
                    {% elif question.question_type == 'date' %}
                        <input type="date" name="question_{{ question_id }}" value="{{answers|dict_get:question_id }}">
                    {% elif question.question_type == 'time' %}
                        <input type="time" name="question_{{ question_id }}" value="{{answers|dict_get:question_id }}">
                    {% endif %}
                {% endwith %}
            </div>
        {% endfor %}
        <button type="submit">Save Changes</button>
    </form>

    <form method="post" action="{% url 'form:delete_response' response_instance.id %}">
        {% csrf_token %}
        <button type="submit" onclick="return confirm('Are you sure you want to delete this response?');">Delete Response</button>
    </form>

    <a href="{% url 'form:form_detail' form_instance.id %}">Back to Form Details</a>
</div>
</center>
</body>
</html>
