<!DOCTYPE html>
<html lang="en">
  {% load static %}
<head>
  <meta charset="UTF-8" />
  <title>Sports Management Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #fafcff; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 30px auto; background: #fff; border-radius: 8px; box-shadow: 0 1px 8px #0001; padding: 32px; }
    .top-filters { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
    .search-bar { flex: 1; }
    .search-bar input { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #cfd8dc; }
    .toggle-group { display: flex; align-items: center; gap: 6px; }
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { padding: 8px 20px; border-radius: 6px 6px 0 0; background: #edf2fa; cursor: pointer; border-bottom: 2px solid transparent; }
    .tab.active { background: #ffffff; border-bottom: 2px solid #50b948; font-weight: bold; }
    .card-list { margin-bottom: 16px; }
    .divider { border-top: 2px solid #e4e4e4; margin: 18px 0; }
    .card { background: #f7fbff; border-radius: 6px; margin-bottom: 10px; box-shadow: 0 1px 4px #0001; padding: 16px; transition: background 0.2s; cursor: pointer; position: relative; }
    .card.expanded { background: #e9f5ec; }
    .card-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .card-title { font-size: 1.1rem; font-weight: bold; }
    .status { padding: 4px 10px; border-radius: 12px; font-size: 0.9em; font-weight: bold; color: #fff; }
    .status.active { background: #35a957; }
    .status.closed { background: #d83b3b; }
    .card-details { margin-top: 14px; }
    .count { color: #1976d2; cursor: pointer; margin-right: 16px; }
    .dropdown-list { background: white; border: 1px solid #cfd8dc; border-radius: 6px; padding: 10px; position: absolute; top: 40px; left: 40px; box-shadow: 0 3px 16px #0002; width: 220px; z-index: 10; }
    .dropdown-list ul { margin: 0; padding: 0; list-style: none; }
    .dropdown-list li { padding: 4px 0; font-size: 0.98em; border-bottom: 1px solid #ececec; }
    .dropdown-list li:last-child { border-bottom: none; }
    @media (max-width: 650px) {
      .container { padding: 9px; }
      .tabs { flex-wrap: wrap; }
      .tab { padding: 8px 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Filters -->
    <div class="top-filters">
      <div class="toggle-group">
        <input type="checkbox" id="categoryToggle" checked />
        <label for="categoryToggle">Category Listing</label>
      </div>
      <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search teams, camps, tournaments..." />
      </div>
      <button id="newTeamBtn" style="background: #50b948; color: white; border: none; padding: 8px 16px; border-radius: 5px; font-size: 15px; cursor: pointer;">+ New Team</button>
    </div>

    <!-- Category Tabs -->
    <div id="categoryTabs" class="tabs">
      {% for cat_key, display_name, teams in categories %}
        <div class="tab {% if forloop.first %}active{% endif %}" data-tab="{{ cat_key }}">{{ display_name }}</div>
      {% endfor %}
    </div>

    <!-- Category Cards -->
    <div id="tabContent" class="card-list">
      {% for cat_key, display_name, teams in categories %}
        <div class="category-content" data-category="{{ cat_key }}" style="{% if not forloop.first %}display:none{% endif %}">
          {% for team in teams %}
            <div class="card" data-category="{{ cat_key }}" onclick="expandCard(event)">
              <div class="card-header">
                {% if team.images %}
                  <img src="{{ team.images.url }}" alt="{{ team.name }} Logo" style="height:50px; width:50px; object-fit:cover; border-radius:30px; margin-right:10px;margin-bottom:10px">
                {% else %}
                  <img src="{% static 'default_team_logo.png' %}" alt="Default Logo" style="height:50px; width:50px; object-fit:cover; border-radius:6px; margin-right:10px;margin-bottom:10px">
                {% endif %}
                
                <div class="card-title">{{ team.name }}</div>
                <span class="status active" >Active</span>
              </div>
              <div>
                <span class="count"  onclick="toggleDropdown(event, 'athlete', '{{ forloop.counter0 }}', '{{ cat_key }}', false)">{{ team.players.count }} athletes</span>
                <span class="count" onclick="toggleDropdown(event, 'staff', '{{ forloop.counter0 }}', '{{ cat_key }}', false)">{{ team.staff.count }} staff</span>
              </div>
              <div class="dropdown-list" id="dropdown-athlete-{{ cat_key }}-{{ forloop.counter0 }}" style="display:none;">
                <ul>
                  {% for player in team.players.all %}
                    <li>{{ player.name }}</li>
                  {% endfor %}
                </ul>
              </div>
              <div class="dropdown-list" id="dropdown-staff-{{ cat_key }}-{{ forloop.counter0 }}" style="display:none;">
                <ul>
                  {% for staff_member in team.staff.all %}
                    <li>{{ staff_member.name }}</li>
                  {% endfor %}
                </ul>
              </div>
              <div class="card-details" style="display:none;">
                <em>Additional details for {{ team.name }}</em>
              </div>
            </div>
          {% empty %}
            <p>No teams available in this category.</p>
          {% endfor %}
        </div>
      {% endfor %}
    </div>

    <div class="divider"></div>

    <!-- Camps/Tournaments Tabs -->
    <div id="campTabs" class="tabs">
      <div class="tab active" data-tab="ongoing">Ongoing Camps/Tournaments</div>
      <div class="tab" data-tab="closed">Closed Camps/Tournaments</div>
    </div>
    <div id="campTabContent" class="card-list">
      <div class="camp-list" data-camp-tab="ongoing">
        {% for camp in camps.ongoing %}
          <div class="card" onclick="expandCard(event)">
            <div class="card-header">
              <div class="card-title">{{ camp.name }}</div>
              <span class="status active">Active</span>
            </div>
            <div>
              <span class="count" onclick="toggleDropdown(event, 'athlete', '{{ forloop.counter0 }}', 'ongoing', true)">{{ camp.participants.count }} athletes</span>
              <span class="count" onclick="toggleDropdown(event, 'staff', '{{ forloop.counter0 }}', 'ongoing', true)">{{ camp.organization.staff_set.count }} staff</span>
            </div>
            <div class="dropdown-list" id="dropdown-athlete-ongoing-{{ forloop.counter0 }}" style="display:none;">
              <ul>
                {% for player in camp.participants.all %}
                  <li>{{ player.name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="dropdown-list" id="dropdown-staff-ongoing-{{ forloop.counter0 }}" style="display:none;">
              <ul>
                {% for staff_member in camp.organization.staff_set.all %}
                  <li>{{ staff_member.name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="card-details" style="display:none;">
              <em>Additional details for {{ camp.name }}</em>
            </div>
          </div>
        {% empty %}
          <p>No ongoing camps/tournaments</p>
        {% endfor %}
      </div>
      <div class="camp-list" data-camp-tab="closed" style="display:none;">
        {% for camp in camps.closed %}
          <div class="card" onclick="expandCard(event)">
            <div class="card-header">
              <div class="card-title">{{ camp.name }}</div>
              <span class="status closed">Closed</span>
            </div>
            <div>
              <span class="count" onclick="toggleDropdown(event, 'athlete', '{{ forloop.counter0 }}', 'closed', true)">{{ camp.participants.count }} athletes</span>
              <span class="count" onclick="toggleDropdown(event, 'staff', '{{ forloop.counter0 }}', 'closed', true)">{{ camp.organization.staff_set.count }} staff</span>
            </div>
            <div class="dropdown-list" id="dropdown-athlete-closed-{{ forloop.counter0 }}" style="display:none;">
              <ul>
                {% for player in camp.participants.all %}
                  <li>{{ player.name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="dropdown-list" id="dropdown-staff-closed-{{ forloop.counter0 }}" style="display:none;">
              <ul>
                {% for staff_member in camp.organization.staff_set.all %}
                  <li>{{ staff_member.name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="card-details" style="display:none;">
              <em>Additional details for {{ camp.name }}</em>
            </div>
          </div>
        {% empty %}
          <p>No closed camps/tournaments</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <script>
    // Tab switching for category tabs
    document.querySelectorAll('#categoryTabs .tab').forEach(tab => {
      tab.onclick = function() {
        document.querySelectorAll('#categoryTabs .tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const tabKey = tab.dataset.tab;
        document.querySelectorAll('.category-content').forEach(section => {
          section.style.display = (section.dataset.category === tabKey) ? 'block' : 'none';
        });
      };
    });

    // Tab switching for camps/tournaments tabs
    document.querySelectorAll('#campTabs .tab').forEach(tab => {
      tab.onclick = function() {
        document.querySelectorAll('#campTabs .tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const tabKey = tab.dataset.tab;
        document.querySelectorAll('#campTabContent .camp-list').forEach(div => {
          div.style.display = (div.dataset.campTab === tabKey) ? 'block' : 'none';
        });
      };
    });

    // Expand card details
    function expandCard(event) {
      if (event.target.classList.contains('count') || event.target.closest('.dropdown-list')) return;
      const card = event.currentTarget;
      card.classList.toggle('expanded');
      const details = card.querySelector('.card-details');
      if (details) {
        details.style.display = (details.style.display === 'block') ? 'none' : 'block';
      }
    }

    // Toggle dropdowns for athletes and staff
    function toggleDropdown(event, type, idx, tabKey, isCamp) {
      event.stopPropagation();

      // Close other dropdowns except the current
      document.querySelectorAll('.dropdown-list').forEach(dl => {
        if (dl.id !== `dropdown-${type}-${tabKey}-${idx}`) {
          dl.style.display = 'none';
        }
      });

      const el = document.getElementById(`dropdown-${type}-${tabKey}-${idx}`);
      if (el) {
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
      }
    }

    // Close dropdowns on clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.dropdown-list') && !event.target.classList.contains('count')) {
        document.querySelectorAll('.dropdown-list').forEach(dl => {
          dl.style.display = 'none';
        });
      }
    });

    // Toggle category listing filter
    document.getElementById('categoryToggle').addEventListener('change', (e) => {
      const checked = e.target.checked;
      document.getElementById('categoryTabs').style.display = checked ? 'flex' : 'none';
      document.getElementById('tabContent').style.display = checked ? 'block' : 'none';
    });

    // Search filter for teams, camps and tournaments by their displayed names
    document.getElementById('searchInput').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();

      // Filter teams
      document.querySelectorAll('.category-content').forEach(section => {
        Array.from(section.children).forEach(card => {
          const title = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
          card.style.display = title.includes(query) ? 'block' : 'none';
        });
      });

      // Filter camps
      document.querySelectorAll('#campTabContent .camp-list .card').forEach(card => {
        const title = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
        card.style.display = title.includes(query) ? 'block' : 'none';
      });
    });
  </script>
</body>
</html>
